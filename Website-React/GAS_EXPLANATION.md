# ⛽ Gas 费用说明

## 🤔 为什么需要两次 Gas？

### 区块链交易的本质

在区块链上，**每个操作都是一个独立的交易**，需要支付 Gas 费用：

1. **部署合约** = 1 个交易 = 1 次 Gas
2. **调用 mint 函数** = 1 个交易 = 1 次 Gas

**这两个操作无法合并！** 因为：
- 部署时，合约还不存在，无法调用它的函数
- 必须先部署合约，然后才能调用它的函数

### 你的测试代码分析

你的 `deploy-basic-nft.py`：

```python
def deploy_basic_nft():
    contract = basic_nft.deploy()  # 交易 1：部署合约（需要 Gas）
    contract.mint(NFT_URI)         # 交易 2：铸造 NFT（需要 Gas）
```

**实际上还是两次交易，两次 Gas！**

Moccasin 只是自动执行了这两步，但区块链上仍然是两个独立的交易。

## 💡 解决方案

### 方案 1：在构造函数中自动铸造（推荐用于测试）

修改合约，部署时自动铸造一个 NFT：

```vyper
@deploy
def __init__():
    ow.__init__()
    erc721.__init__(NAME, SYMBOL, BASE_URI, NAME, EIP_712_VERSION)
    
    # 部署时自动铸造一个 NFT（只需要一次 Gas）
    token_id: uint256 = erc721._counter
    erc721._counter = token_id + 1
    erc721._safe_mint(msg.sender, token_id, b"")
    erc721._set_token_uri(token_id, "默认URI")
```

**优点：**
- ✅ 只需要一次 Gas（部署时）
- ✅ 部署后立即拥有一个 NFT
- ✅ 适合测试

**缺点：**
- ❌ 只能铸造一个固定 URI 的 NFT
- ❌ 不够灵活

### 方案 2：前端"部署并铸造"功能

在前端添加一个选项，部署成功后自动铸造：

1. 部署合约（用户确认）
2. 部署成功后，自动弹出铸造确认
3. 用户确认后铸造 NFT

这样用户体验更好，但仍然需要两次 Gas。

### 方案 3：手动填写到钱包（你当前的做法）

1. 部署合约（一次 Gas）
2. 手动在钱包中添加 NFT（不需要 Gas，只是显示）

**这是最省 Gas 的方式！** 但前提是：
- 你需要知道 Token ID
- 或者钱包支持只通过合约地址添加 NFT

## 🎯 推荐做法

### 测试环境
- 使用方案 1（构造函数自动铸造）
- 或使用方案 3（手动添加）

### 生产环境
- 保持当前设计（部署 + 按需铸造）
- 更灵活，用户可以选择何时铸造

## 📊 对比

| 方案 | Gas 次数 | 灵活性 | 适用场景 |
|------|---------|--------|---------|
| 当前设计 | 2 次 | ⭐⭐⭐⭐⭐ | 生产环境 |
| 构造函数铸造 | 1 次 | ⭐⭐ | 测试环境 |
| 手动添加 | 1 次 | ⭐⭐⭐ | 测试/演示 |

## ✅ 总结

**为什么需要两次 Gas？**
- 部署和调用函数是两个独立的区块链操作
- 技术上无法合并成一个交易

**如何节省 Gas？**
- 测试时：在构造函数中自动铸造
- 或：部署后手动添加到钱包（不需要铸造）

**你的测试代码实际上也是两次 Gas，只是 Moccasin 自动执行了。**

